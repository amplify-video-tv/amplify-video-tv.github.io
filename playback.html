<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Video Playback</title>

<style>
html,body{
 margin:0;
 height:100%;
 background:#000;
 overflow:hidden;
}
.feed{
 height:100%;
 overflow-y:scroll;
 scroll-snap-type:y mandatory;
 -webkit-overflow-scrolling:touch;
}
.item{
 height:100%;
 position:relative;
 scroll-snap-align:start;
}
video{
 width:100%;
 height:100%;
 object-fit:cover;
}
.sound{
 position:absolute;
 top:20px;
 right:20px;
 font-size:22px;
 background:rgba(0,0,0,.4);
 padding:8px;
 border-radius:50%;
 cursor:pointer;
 color:#fff;
 z-index:10;
}
</style>
</head>

<body>

<div class="feed" id="feed"></div>

<script>
const feed = document.getElementById("feed");
let currentVideo = null;
let scrollLocked = false;

/* ===== LOAD DATA ===== */
const list = JSON.parse(localStorage.getItem("VIDEO_LIST")) || [];
let start = parseInt(localStorage.getItem("START_INDEX")) || 0;
if(!list.length) location.href="index.html";

/* ===== ORDER LIST ===== */
const ordered = [...list.slice(start), ...list.slice(0,start)];

/* ===== RENDER ===== */
ordered.forEach((v,i)=>{
 const item = document.createElement("div");
 item.className = "item";
 item.dataset.vid = v.id;
 item.dataset.index = i;

 item.innerHTML = `
  <video src="${v.src}" muted loop playsinline></video>
  <div class="sound" onclick="toggleSound(this)">ðŸ”‡</div>
 `;
 feed.appendChild(item);
});

/* ===== SOUND ===== */
function toggleSound(btn){
 const v = btn.closest(".item").querySelector("video");
 v.muted = !v.muted;
 btn.textContent = v.muted ? "ðŸ”‡" : "ðŸ”Š";
}

/* ===== SCROLL LOCK ===== */
function lockScroll(){
 scrollLocked = true;
 setTimeout(()=>scrollLocked=false, 500);
}

feed.addEventListener("touchmove",e=>{
 if(scrollLocked) e.preventDefault();
},{passive:false});

feed.addEventListener("wheel",e=>{
 if(scrollLocked) e.preventDefault();
},{passive:false});

/* ===== OBSERVER ===== */
const observer = new IntersectionObserver(entries=>{
 entries.forEach(e=>{
  const v = e.target.querySelector("video");
  const vid = e.target.dataset.vid;
  const sound = e.target.querySelector(".sound");

  if(e.isIntersecting){
   lockScroll();

   if(currentVideo && currentVideo !== v){
    currentVideo.pause();
    currentVideo.muted = true;
   }

   currentVideo = v;
   v.play().catch(()=>{});

   history.replaceState(null,"","playback.html?vid="+vid);
   document.title = "â–¶ " + vid;

   sound.textContent = v.muted ? "ðŸ”‡" : "ðŸ”Š";
  }else{
   v.pause();
  }
 });
},{threshold:0.9});

document.querySelectorAll(".item").forEach(i=>observer.observe(i));

/* ===== JUMP FROM URL ===== */
const urlVid = new URLSearchParams(location.search).get("vid");
if(urlVid){
 const idx = ordered.findIndex(v=>v.id===urlVid);
 if(idx > -1){
  setTimeout(()=>{
   feed.children[idx].scrollIntoView();
  },200);
 }
}
</script>

  <!-- Histats.com  START  (aync)-->
<script type="text/javascript">var _Hasync= _Hasync|| [];
_Hasync.push(['Histats.start', '1,4992245,4,511,95,18,00000000']);
_Hasync.push(['Histats.fasi', '1']);
_Hasync.push(['Histats.track_hits', '']);
(function() {
var hs = document.createElement('script'); hs.type = 'text/javascript'; hs.async = true;
hs.src = ('//s10.histats.com/js15_as.js');
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(hs);
})();</script>
<noscript><a href="/" target="_blank"><img  src="//sstatic1.histats.com/0.gif?4992245&101" alt="" border="0"></a></noscript>
<!-- Histats.com  END  -->
</body>
</html>
